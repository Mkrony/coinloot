import nodemailer from "nodemailer";
import {
    EMAIL_HOST,
    EMAIL_PORT,
    EMAIL_USER,
    EMAIL_PASSWORD,
    EMAIL_SECURE,
    EMAIL_UN_AUTH,
} from "../config/config.js";

const transporter = nodemailer.createTransport({
    host: EMAIL_HOST,
    port: EMAIL_PORT,
    secure: EMAIL_SECURE, // Use SSL for port 465, false for TLS (587)
    auth: {
        user: EMAIL_USER,
        pass: EMAIL_PASSWORD,
    },
    tls: {
        rejectUnauthorized: EMAIL_UN_AUTH, // Allow self-signed certificates
    },
    connectionTimeout: 10000, // 10 seconds timeout
});

/**
 * Send an email using Nodemailer
 * @param {string} to - Recipient's email address
 * @param {string} subject - Email subject
 * @param {string} html - HTML email body
 * @returns {Promise<boolean>} - Returns true if email is sent successfully
 */
export const sendEmail = async (to, subject, html) => {
    try {
        const mailOptions = {
            from: `"zedcash" <${EMAIL_USER}>`, // Proper sender format
            to,
            subject,
            html, // Only send HTML content
        };
        await transporter.sendMail(mailOptions);
        return true;
    } catch (error) {
        console.error("Email sending failed:", error); // Log the error for debugging
        return false;
    }
};